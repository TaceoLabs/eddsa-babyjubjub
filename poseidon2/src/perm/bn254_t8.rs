use crate::perm::Poseidon2Permutation;
/// Parameters are compatible with the original Poseidon2 parameter generation script found at:
/// [https://github.com/HorizenLabs/poseidon2/blob/main/poseidon2_rust_params.sage](https://github.com/HorizenLabs/poseidon2/blob/main/poseidon2_rust_params.sage)
use ark_ff::MontFp;

type Scalar = ark_bn254::Fr;

const T: usize = 8;
const D: u64 = 5;
const ROUNDS_F: usize = 8;
const ROUNDS_P: usize = 57;

const MAT_DIAG_M_1: [Scalar; T] = [
    MontFp!("2600766909924179814780409961696866414079699656430070499803459729017893381997"),
    MontFp!("19293363242678774625215171492393209093707286181479006293654394057747218353607"),
    MontFp!("21414786808156610356356451480905960406647514095406216853368573063004475600640"),
    MontFp!("8215135898581116354906741804378477022438799156627805573019887031189487620936"),
    MontFp!("9165814748476180913577766403125055556952884368727238651703828504915350029819"),
    MontFp!("15078459252378813527385228808553999657222567675360137586804698725603240352055"),
    MontFp!("5648186893216350474836221186116590993767413676065426352255299742021094533501"),
    MontFp!("20725344080263893594397636575905698660034655258256134536883719628954264697683"),
];
const EXTERNAL_RC: [[Scalar; T]; ROUNDS_F] = [
    // First external
    [
        MontFp!("6185971855411162074766697458123925010627072312280999677222289477835083549712"),
        MontFp!("1724030384642535118742396647037976499951864833914353283771519017980834680889"),
        MontFp!("17991484256344069161024878419282655810799161257241057852219897507769436955538"),
        MontFp!("18521030746084911716440054867428153034894255791372828209819066665846725045293"),
        MontFp!("4624302723920942142621628597917919292162168854676287400810377757290702987989"),
        MontFp!("19250184213175013633315426254030617494683201459834830966173613753517817746518"),
        MontFp!("5850957861898866715331673474749994761647438257322800400328304380896878743311"),
        MontFp!("13053758982068992266010708335264860031985876074514924398815148845160693228843"),
    ],
    [
        MontFp!("4605121938203267397307990599337357306693544519089474795273671995632528734678"),
        MontFp!("10375062636167949025766643124599278025925391773795164866071936849020466308887"),
        MontFp!("18854625995434609636790943146998982104369242475919840403631509550129965624248"),
        MontFp!("15153330172005758409443013079751600550308675196705374669279587756441683909435"),
        MontFp!("3505519280603870575882993646719032278434542217162253346301354214484466231561"),
        MontFp!("15710866108444979210256665178545786409369193493879579720087887153479946631013"),
        MontFp!("20660355203246066396328807090762146122840783151433045604864676968467409386286"),
        MontFp!("18624213583497786667583089067168936190462720622926120566844616046401585770129"),
    ],
    [
        MontFp!("18018897708012459767749119717840133327991192537457569981533106071103329565324"),
        MontFp!("6357436457958987383881142698359363122088184258538051776125420037733540143784"),
        MontFp!("9044063898748957765350862996816208748332631957913261563208175559084026566258"),
        MontFp!("17790478481891303893050010132937900471039401122734673299887960156385448981442"),
        MontFp!("13524924066179110979488041702673803989977815461165994569110934678482962845449"),
        MontFp!("9394688084589380760330715734012339670375982014354179996924272968741320651677"),
        MontFp!("18068595945132771876579018617926968107682673421552015992818164034358734194307"),
        MontFp!("14161787359009610411901394157805364085901199731213712576537912224103001526165"),
    ],
    [
        MontFp!("6054505935525748072819813902041247356726011245072624400377099673939086879729"),
        MontFp!("15700711543565498828930498160305408503717771768712831079824005764086362095364"),
        MontFp!("1642580373022711198848822370917904699185499547818425340499540067491249819285"),
        MontFp!("17088826671722837613590950994923397247599959612531563217358508728333503434348"),
        MontFp!("12845237382535155163608262337098264470887129325181304773644312380311124157315"),
        MontFp!("18658312219466086615171402106644082180414968103867314920428689707288029916747"),
        MontFp!("8723609925942855149617167794810984629316912549962608995329917053135047835150"),
        MontFp!("12852525402691981298464400655491145655006090423673389344523588130525022776773"),
    ],
    // Second external
    [
        MontFp!("325769825675677991122275710878337963329644841908930390239927391807722922745"),
        MontFp!("11970751313465862288104706151456332187331647831716138711900107469193279535401"),
        MontFp!("14700023073636628972178906816647011967761581660094273945114862607279431488893"),
        MontFp!("6312356320668417133504720757364308873974120143504702618219243185719391730248"),
        MontFp!("21339895041589420035734905079495848135398264187849427798379205261151680772943"),
        MontFp!("21402709581442499637168570837614761145101265728941644259724475019861723401086"),
        MontFp!("7959509890657582206820887296544713810168001384618566857453445531438676115993"),
        MontFp!("11313840613585282430134607215755668867602120135217553007257517781949847355459"),
    ],
    [
        MontFp!("4284324288004149333468328754323484843065645307119845277945807657005311365225"),
        MontFp!("15885410336918850966023434367710881993748400988739708038771689161563443420389"),
        MontFp!("7119544831947197909065381250309054258218952518932576769653245178097706489538"),
        MontFp!("14887417224418021812540774554587707920082407371878546395405781187083118367931"),
        MontFp!("9828306054804530273227162125690976816856039612208163401087347572880397679104"),
        MontFp!("5534834253565592487905090885713595513611906565844093974194814223753702429907"),
        MontFp!("17904596178432692175987990934689952828157521551000583838672500110811367005680"),
        MontFp!("7539968618739669822127983003040555444750213273568115785120145526341294008346"),
    ],
    [
        MontFp!("20476058575057602850276090063742379224515865279900586464654279546536342836057"),
        MontFp!("9712845467770645726754326890438761469846438432701845645914656738352143067065"),
        MontFp!("21835241210858418779584398792232303874950465775267215082488758463426240385898"),
        MontFp!("4250506992839950152691277846833671639337838066493538904526708477255284476161"),
        MontFp!("16430107346878435749163715324732875933829113450193350924038630467597385854037"),
        MontFp!("15382219234883964792199819313377836577298852498603822295887353837822812755741"),
        MontFp!("3689506249300430809092645930643780724397822116051822384985569996823614878810"),
        MontFp!("10650978086166976560149882787185559531590051792707637474009639393788610188775"),
    ],
    [
        MontFp!("8448292245962226216878466454798839639599122091688770731618496749611153019370"),
        MontFp!("15644566581542577427181237112076243018923241078397521637869410760552891200708"),
        MontFp!("16779839888396234243875367626698309659303541923978223265319894125462019429577"),
        MontFp!("387436294381309063766117393522888593617166430765918319912395657778319583164"),
        MontFp!("19742587203640852987937604483113921290047559356422597948660367500381507479884"),
        MontFp!("8803727408373463506985986440943110560680498616210031043937226122477307733019"),
        MontFp!("8685803829756651961139423483493080581300034756321254813011757349296534153794"),
        MontFp!("18431340421928355300525524951433557706589672910809779800785717952222821195818"),
    ],
];
const INTERNAL_RC: [Scalar; ROUNDS_P] = [
    MontFp!("6166723764694833450065648388287046364167891638525417061490992373344049817434"),
    MontFp!("9660957876566304791647061793381893618609927508490703828146231697132980821342"),
    MontFp!("2409949786246037446652375787354573125031904848168216907230058300593174293558"),
    MontFp!("8577405115198319968504482245754906847226010594499760960963264961871798078166"),
    MontFp!("21568996620020294134924539054121237983301238951405143078318411281556570578437"),
    MontFp!("12873646597425861100066915112140151968527313520820100870275872098518102233563"),
    MontFp!("6158384384822116704305931394322916398637014914220992387450018163658103627997"),
    MontFp!("299860370529274166327975735740962194311184586692778952868764986499441103571"),
    MontFp!("3609139110299285456878026453556980631662308330881853081219120867789605635491"),
    MontFp!("8129178360283561437505641096202359748889763472505184288602986189796712183085"),
    MontFp!("13730430496235812115926374861866183055956300197597793353426053872051349552"),
    MontFp!("9893802097685288908764371115129667530153823557169739738455539663670397684882"),
    MontFp!("15040800692154521877078461684981024911380432411241896127104001680631590333546"),
    MontFp!("8029325327205502512634494423990025096559197273298827061666964420652679935765"),
    MontFp!("3374629896425349961822191576086015692034302480211216529527986669816062197983"),
    MontFp!("971317147922490226123531593118582802113637008867155711256345714772814949279"),
    MontFp!("14520742940454408850549144051199664863426136098906482756345169235270539455567"),
    MontFp!("8387911065767075029927818566150680909856066577545191351656637902710448392907"),
    MontFp!("4616429779610195318346989116839202411301940112881459095821928832752204580921"),
    MontFp!("18109780903220752792283046875041312567187709273972792292561491734130283812302"),
    MontFp!("16158105629401485208107216062483043707890123814570681032524021667869498641379"),
    MontFp!("12950390177732447227090982314691482924734450721620664187079538601085280089257"),
    MontFp!("1708928386007774945943569879236450935330294326801332868465349742530077871742"),
    MontFp!("335881512806303834150747128233068503649221103055646238116632113410154967061"),
    MontFp!("20131648592695071027727273642230953685733584424928837314778049757854840079910"),
    MontFp!("5229796200050266808340101266231857122687733618498135686842430747839134743159"),
    MontFp!("12690521858351930217072752509832723229275590140515575424789183538094387461468"),
    MontFp!("14562123618883573373355754714435919043310066571405976166839493316079109414100"),
    MontFp!("6425700529613525041661522260379715440917917716073153577095070809982180006060"),
    MontFp!("19027077459820350959564509381534660746339867395078120470129277989880387554506"),
    MontFp!("2356527514187713542370657952179536754548385956054624279342377398885047587255"),
    MontFp!("8503310282209625046560260713691194881068175710660851410335328766307192982552"),
    MontFp!("14143262003265686539845763133407771041650846080811469064895311474158307512940"),
    MontFp!("13288304161132010751562836473124689354527742034509237527928751241470250041459"),
    MontFp!("2550973621838405710543256220920564337783850085003297134903543507707073619592"),
    MontFp!("12618280530191168282139167009044459804543398073667883214945482802235984764013"),
    MontFp!("13294032442451598109757055042768611704654204968152937608092455183660833033643"),
    MontFp!("21275737500529089703584197309800610733451112851769833954411879158488501693850"),
    MontFp!("10868456178771711609113388544013129874026537341783931975143636910998627294007"),
    MontFp!("6837109541765016118434567860089461089739113488758183127471062914562817928733"),
    MontFp!("10671431651171071021382630668670098142969813924315486140323620234357368120778"),
    MontFp!("19385360823570505114937205243668368821841003585908799165248227310425737248173"),
    MontFp!("8720587912420827828929950729967543459284446967355593707285081705957930776022"),
    MontFp!("9678001497925654300208915570576371412373821526847340223687886875197902610206"),
    MontFp!("876451111785728475210752694701651619456565614277702154788251173140227418320"),
    MontFp!("9637686654914078905594367896940356858263847322335093657484749632602933334519"),
    MontFp!("14201856621627225716222733707918755141590966406877901399050788249638347107577"),
    MontFp!("16743783990771467383609560934571398810085366991634179692404326909069661067128"),
    MontFp!("16412998804046081754844964835213534366765343967397415782117522090583788892678"),
    MontFp!("20178809273076659073156782614372100458904958440957898162192131995766487160888"),
    MontFp!("19724750590364803332101501227546249484878157707752246198715831238931236387012"),
    MontFp!("5035403713532108960896553646893197947001009534715719759626019335337460892786"),
    MontFp!("7444492650653896240569670238416666698739188449846285554997794847891914186796"),
    MontFp!("8349157392462489468580194579518006023180081186300436655615858369342102373962"),
    MontFp!("16490186449856515634974410353165889049974838794932231663896278478260153612752"),
    MontFp!("20914955734991772711364516452558275096278633881890939990050698300211229312317"),
    MontFp!("8035554494834423323003967067057971875998167691949757211803080353901549573675"),
];

/// The Poseidon2 parameters for the BN254 curve with a internal state of size t=8.
pub(crate) const POSEIDON2_BN254_T8_PARAMS: Poseidon2Permutation<Scalar, T, D, ROUNDS_F, ROUNDS_P> =
    Poseidon2Permutation::new(MAT_DIAG_M_1, EXTERNAL_RC, INTERNAL_RC);

/// Applies the Poseidon2 permutation to a 8-element state over `bn254`.
///
/// Returns a new permuted state based on the input.
///
/// # Arguments
/// * `state` - A reference to the input state array (`[ark_bn254::Fr; 8]`).
///
/// # Returns
/// A permuted state as `[ark_bn254::Fr; 8]`.
pub fn t8_permutation(state: &[ark_bn254::Fr; 8]) -> [ark_bn254::Fr; 8] {
    POSEIDON2_BN254_T8_PARAMS.permutation(state)
}

/// Applies the Poseidon2 permutation in place to a 8-element state over `bn254`.
///
/// Mutates the input state array directly.
///
/// # Arguments
/// * `state` - A mutable reference to the state array (`[ark_bn254::Fr; 8]`).
pub fn t8_permutation_in_place(state: &mut [ark_bn254::Fr; 8]) {
    POSEIDON2_BN254_T8_PARAMS.permutation_in_place(state)
}
